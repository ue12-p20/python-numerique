
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>broadcasting &#8212; Python numérique</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="agrégation" href="2-06-numpy-aggregate.html" />
    <link rel="prev" title="indexation et slicing" href="2-04-numpy-indexing-slicing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      <h1 class="site-logo" id="site-title">Python numérique</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0-01-intro.html">
   UE 12 - Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  intro et installation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0-02-outils.html">
   outils de base
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1-01-environnement.html">
   UE12 - Python : généralités
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-02-rudiments.html">
   rudiments de Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-03-operateurs.html">
   opérateurs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-04-fonctions.html">
   fonctions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-05-types-methodes.html">
   objets, types et méthodes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-06-containers.html">
   types évolués
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-07-references-partagees.html">
   références partagées
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-08-iterations.html">
   itérations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-09-modules.html">
   modules
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1-10-classes.html">
   classes
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  numpy
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2-01-numpy-intro.html">
   UE12 - numpy : introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-02-numpy-type-memory.html">
   numpy et la mémoire
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-03-numpy-vectorization.html">
   la vectorisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-04-numpy-indexing-slicing.html">
   indexation et slicing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   broadcasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-06-numpy-aggregate.html">
   agrégation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-07-numpy-array-testing.html">
   masques et tableaux booléens
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-08-numpy-linalg.html">
   algèbre linéaire
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  pandas
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="3-01-pandas-intro.html">
   UE12 - pandas et matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3-02-pandas-modifying-slicing.html">
   modifications et
   <em>
    slicing
   </em>
   de dataframe
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3-04-pandas-sorting.html">
   trier une dataframe
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3-05-pandas-group-by.html">
   regroupement de données
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas.DataFrame.groupby
    </span>
   </code>
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  matplotlib
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="4-01-matplotlib-intro.html">
   dataviz avec
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-03-matplotlib-figure-and-sub-figures.html">
   figures et sous-figures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-04-matplotlib-pandas-dataframe.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
   &amp;
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-05-matplotlib-plots-3D.html">
   des graphiques en 3D
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/2-05-numpy-broadcast.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/2-05-numpy-broadcast.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/boisgera/python-numerique"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/boisgera/python-numerique/issues/new?title=Issue%20on%20page%20%2F2-05-numpy-broadcast.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/boisgera/python-numerique/edit/master/notebooks/2-05-numpy-broadcast.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/boisgera/python-numerique/master?urlpath=tree/notebooks/2-05-numpy-broadcast.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operation-sur-des-tableaux-de-meme-forme">
   opération sur des tableaux de même forme
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operation-sur-tableaux-de-formes-differentes-broadcasting">
   opération sur tableaux de formes différentes (
   <em>
    broadcasting
   </em>
   )
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comment-ca-marche">
     comment ça marche ?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regles-de-broadcasting-pour-les-avances">
   règles de broadcasting (pour les avancés)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#le-broadcasting-en-dimension-2">
   le broadcasting en dimension &gt; 2
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   exercices
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparaison-des-temps-d-execution-de-l-ajout-d-un-scalaire-a-une-matrice">
     comparaison des temps d’exécution de l’ajout d’un scalaire à une matrice
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#resultats-du-tirage-de-n-des-a-s-faces">
     résultats du tirage de
     <code class="docutils literal notranslate">
      <span class="pre">
       n
      </span>
     </code>
     dès à
     <code class="docutils literal notranslate">
      <span class="pre">
       s
      </span>
     </code>
     faces
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#version-pour-les-debutants">
       version pour les débutants
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#les-des-version-pour-les-forts">
       les dès version  pour les forts
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="licence">
<span>Licence CC BY-NC-ND</span>
<span>Valérie Roy</span>
</div>
<img alt="_images/ensmp-25-alpha.png" src="_images/ensmp-25-alpha.png" />
<p>Vous y êtes habitués, on importe notre librarie <code class="docutils literal notranslate"><span class="pre">numpy</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="broadcasting">
<h1>broadcasting<a class="headerlink" href="#broadcasting" title="Permalink to this headline">¶</a></h1>
<p>ou comment faire des opérations sur des tableaux qui ont des formes différentes</p>
<div class="section" id="operation-sur-des-tableaux-de-meme-forme">
<h2>opération sur des tableaux de même forme<a class="headerlink" href="#operation-sur-des-tableaux-de-meme-forme" title="Permalink to this headline">¶</a></h2>
<p>Vous savez désormais construire des tableaux <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> en leur donnant des formes (vecteurs, matrices, images…) et vous savez faires des opérations vectorielles (vectorisées) sur ces tableaux <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code>.</p>
<p>Construisons deux matrices donnons leur la même <strong>forme</strong> et (par exemple) des types différents:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">m1</span></code> de forme (3, 4) et de type entier contenant les valeurs de 1 à 12</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m2</span></code> de forme (3, 4) et de type float contenant des valeurs entre 0 et 1</p></li>
</ul>
<p>Pour les ajouter il n’y aura pas de problème: leur formes sont indentiques (bien sûr si les types ne sont pas cohérents pour l’addition vous aurez des erreurs mais d’un autre genre).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">m1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">m2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.        , 0.09090909, 0.18181818, 0.27272727],
       [0.36363636, 0.45454545, 0.54545455, 0.63636364],
       [0.72727273, 0.81818182, 0.90909091, 1.        ]])
</pre></div>
</div>
</div>
</div>
<p>Pour que ce soit plus lisible, on va arrondir les valeurs de la matrice <code class="docutils literal notranslate"><span class="pre">m2</span></code> à 2 chiffres après la virgule avec la fonction <code class="docutils literal notranslate"><span class="pre">np.round</span></code>, et pour éviter une duplication inutile, on lui indique que sa sortie <code class="docutils literal notranslate"><span class="pre">out</span></code> est elle même:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on arrondit sans copier le tableau</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.  , 0.09, 0.18, 0.27],
       [0.36, 0.45, 0.55, 0.64],
       [0.73, 0.82, 0.91, 1.  ]])
</pre></div>
</div>
</div>
</div>
<p>Maintenant ajoutons <code class="docutils literal notranslate"><span class="pre">m1</span></code> et <code class="docutils literal notranslate"><span class="pre">m2</span></code>, On obtient bien ce qu’on attendait:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.  ,  2.09,  3.18,  4.27],
       [ 5.36,  6.45,  7.55,  8.64],
       [ 9.73, 10.82, 11.91, 13.  ]])
</pre></div>
</div>
</div>
</div>
<p>Donc jusqu’ici nous avons fait une addition sous une forme vectorisée, rien de nouveau.</p>
</div>
<div class="section" id="operation-sur-tableaux-de-formes-differentes-broadcasting">
<h2>opération sur tableaux de formes différentes (<em>broadcasting</em>)<a class="headerlink" href="#operation-sur-tableaux-de-formes-differentes-broadcasting" title="Permalink to this headline">¶</a></h2>
<p>Mais supposons maintenant que nous voulions ajouter <strong>le même scalaire</strong> à tous les éléments d’une matrice. Par exemple on a une matrice d’entiers de taille (3000, 3000) et on veut ajouter 1 à tous les éléments.</p>
<p>Pour le faire, on peut créer une nouvelle matrice de <code class="docutils literal notranslate"><span class="pre">1</span></code> de la même taille et les ajouter…</p>
<p>Franchement, cela demande des manipulations mémoire qui prennent une place inutile et ne sont pas informatives (on a une matrice  de 9 millions de <code class="docutils literal notranslate"><span class="pre">1</span></code>), ensuite elles n’améliorent pas le code voire elles nuisent à sa lisibilité.</p>
<p>Bref c’est complètement sous-optimal. <code class="docutils literal notranslate"><span class="pre">numpy</span></code> propose une manière abrégée d’écrire afin de ne pas avoir à créer de tableaux inutiles, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> se chargera de faire les <em>bonnes</em> opérations.</p>
<p>On appelle cela le broadcasting</p>
<div class="section" id="comment-ca-marche">
<h3>comment ça marche ?<a class="headerlink" href="#comment-ca-marche" title="Permalink to this headline">¶</a></h3>
<p>Souvenez-vous, en <code class="docutils literal notranslate"><span class="pre">numpy</span></code> les tableaux peuvent être de différentes dimensions:</p>
<ul class="simple">
<li><p>en dimension 1 ce sont de simples vecteurs de taille <em>n</em> avec <em>shape=(n,)</em></p></li>
<li><p>en dimension 2 ce sont des  matrices avec <em>shape=(l, c)</em> où <em>l</em> est le nombre de lignes et <em>c</em> de colonnes (qui peuvent être 1)</p></li>
<li><p>en dimension supérieures avec shape=$(n_1, …, n_m, l, c)$ les deux dernières dimensions vont être une matrice</p></li>
</ul>
<p>Une matrice (1, 1) est aussi de dimension 2…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># utilisation d&#39;un f-string (c&#39;est super pratique)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mat=</span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s1"> est de dimension </span><span class="si">{</span><span class="n">mat</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s1"> !&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mat=[[1]] est de dimension 2 !
</pre></div>
</div>
</div>
</div>
<p>et, parlant de <em>f-string</em> d’ailleurs, je vous signale en passant que lorsqu’on a Python-3.8, on peut même raccourcir et transformer</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(f&#39;mat={mat}&#39;)
</pre></div>
</div>
<p>par tout simplement</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(f&#39;{mat=}&#39;)
</pre></div>
</div>
<p>mais reprenons…</p>
<p>Revenons à notre problème d’opérations sur des tableaux de formes différentes. Les opérations dont nous parlons ici sont les opérations qui agissent élément par élément, comme des opérations arithmétiques.</p>
<p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> relâche donc la contrainte et permet aux tableaux impliqués dans des opérations d’avoir des formes différentes et des tailles différentes.</p>
<p>Cela permet des codes plus condensés, plus lisibles et (souvent mais pas toujours) plus rapides que leur version explicite (où tous les tableaux auraient la même forme lors des opérations)</p>
<p>Naturellement ces formes doivent obéir à certaines conditions ! On ne va pas pouvoir faire n’importe quoi !</p>
<p>On va d’abord voir des exemples puis ensuite donner la règle:</p>
<p>Le plus simple: j’ajoute un tableau de dimension 1 ou même un simple scalaire à un tableau de dimension supérieure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="c1"># voila le tableau de taille (6,)</span>
<span class="n">tab</span> <span class="o">+</span> <span class="mi">10</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([10, 11, 12, 13, 14, 15])
</pre></div>
</div>
</div>
</div>
<p>Ou bien, ce qui est sémantiquement pareil:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">tab</span> <span class="o">+</span> <span class="p">[</span> <span class="mi">10</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([10, 11, 12, 13, 14, 15])
</pre></div>
</div>
</div>
</div>
<p>Que s’est-il passé ?</p>
<p>Oui là, le scalaire <code class="docutils literal notranslate"><span class="pre">10</span></code> a été considéré comme un tableau, de la même forme que <code class="docutils literal notranslate"><span class="pre">tab</span></code>
, i.e. de 6 éléments (avec la valeur 10). Nous disons “<em>considéré</em>” parce que l’intérêt est bien que ce tableau n’ait jamais été créé du tout, l’opération est gérée dans le code <code class="docutils literal notranslate"><span class="pre">numpy</span></code> sous-jacent.</p>
<p>En Python qu’est ce que cela donnerait sur une liste ? Essayons :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 4, 5, 6, 10]
</pre></div>
</div>
</div>
</div>
<p>Ah oui c’est très différent ! (c’est bien que Python ait appelé cela des listes et non des tableaux …)</p>
<p>Passons en dimension 2 et ajoutons 10 à une matrice (2, 3):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tab1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">tab1</span> <span class="o">+</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[10, 11, 12],
       [13, 14, 15]])
</pre></div>
</div>
</div>
</div>
<p>Alors comment 10 a-t-il été considéré ? Oui là 10 a été considéré comme une matrice de forme 2 x 3 d’éléments de valeur 10.</p>
<p>On peut continuer à l’infini. A vous de jouer faites une matrice de 3 x 2 x 3 et ajoutez lui 10 le tout en une seule ligne de code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>
</pre></div>
</div>
</div>
</div>
<p>Maintenant passons à des ajouts de tableaux à la place d’un scalaire.<br />
Prenons une matrice, par exemple, de 3 x 5.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
</pre></div>
</div>
</div>
</div>
<p>Qu’est ce que <code class="docutils literal notranslate"><span class="pre">numpy</span></code> peut faire si nous ajoutons, à la matrice <code class="docutils literal notranslate"><span class="pre">mat</span></code> de 3 lignes et 5 colonnes, un tableau de la forme d’une ligne de <code class="docutils literal notranslate"><span class="pre">mat</span></code> ?</p>
<p>C’est à dire de forme <code class="docutils literal notranslate"><span class="pre">(5,)</span></code> ou encore de forme <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">5)</span></code> ? Voici une ligne de la première forme:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>
<span class="n">line</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et oui, on peut ajouter (3, 5) avec (5,)</span>
<span class="n">mat</span> <span class="o">+</span> <span class="n">line</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[100, 201, 302, 403, 504],
       [105, 206, 307, 408, 509],
       [110, 211, 312, 413, 514]])
</pre></div>
</div>
</div>
</div>
<p>Donc ici, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> décide de répéter 3 fois cette ligne pour obtenir une matrice de la même forme que <code class="docutils literal notranslate"><span class="pre">mat</span></code> i.e. (3, 5).<br />
On fait de même avec une matrice de dimension (1, 5) donc 1 ligne et 5 colonnes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">line1</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 5)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et oui, on peut ajouter (3, 5) avec (1, 5)</span>
<span class="n">mat</span> <span class="o">+</span> <span class="n">line1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[100, 201, 302, 403, 504],
       [105, 206, 307, 408, 509],
       [110, 211, 312, 413, 514]])
</pre></div>
</div>
</div>
</div>
<p>Et donc il accepte aussi: il répéte 3 fois cette matrice-ligne pour obtenir une matrice de la même forme que <code class="docutils literal notranslate"><span class="pre">mat</span></code></p>
<p>Vous essayez avec les colonnes ? Il va donc falloir ajouter, à notre matrice de 3 lignes et 5 colonnes, une matrice composée d’une seule colonne et de 3 lignes, qui sera un tableau de taille (3, 1).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">col</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et oui, on peut ajouter (3, 5) avec (3, 1)</span>
<span class="n">mat</span> <span class="o">+</span> <span class="n">col</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1000, 1001, 1002, 1003, 1004],
       [2005, 2006, 2007, 2008, 2009],
       [3010, 3011, 3012, 3013, 3014]])
</pre></div>
</div>
</div>
</div>
<p>ca fait exactement ce à quoi on s’attend !</p>
<p>Et si on essayait d’ajouter une matrice comportant une seule ligne (par exemple de taille (1, 5)) avec une matrice comportant une seule colonne (par exemple de taille (3, 1)) ?</p>
<p>Donc on va ajouter ces deux objets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([100, 200, 300, 400, 500])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1000],
       [2000],
       [3000]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et ça nous donne </span>
<span class="n">line</span> <span class="o">+</span> <span class="n">col</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1100, 1200, 1300, 1400, 1500],
       [2100, 2200, 2300, 2400, 2500],
       [3100, 3200, 3300, 3400, 3500]])
</pre></div>
</div>
</div>
</div>
<p>Oui il déduit bien ce que nous attendions !</p>
<p>Alors maintenant, on commence à saisir sa manière de faire !</p>
<p>Pour les avancés on peut regarder la règle.</p>
</div>
</div>
<div class="section" id="regles-de-broadcasting-pour-les-avances">
<h2>règles de broadcasting (pour les avancés)<a class="headerlink" href="#regles-de-broadcasting-pour-les-avances" title="Permalink to this headline">¶</a></h2>
<p>Les dimensions des deux tableaux (sur lesquels une opération élément-par-élément est appliquée), sont comparées de droite à gauche.</p>
<p>Dans cet ordre, les dimensions sont prises par paire, le broadcasting sera possible:</p>
<ol class="simple">
<li><p>soit si les deux dimensions sont identiques</p></li>
<li><p>soit si l’une des 2 dimensions vaut 1 et auquel cas elle est élargie à la dimension compatible</p></li>
</ol>
<p>Explicitons sur un exemple.</p>
<p>on se donne $A=\begin{pmatrix} a_{11} &amp; a_{12} &amp; a_{13} \ a_{21} &amp; a_{22} &amp; a_{23} \  \end{pmatrix}$ et $b$ un tableau à un scalaire, donc de forme <code class="docutils literal notranslate"><span class="pre">(1,)</span></code></p>
<p>on calcule <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">+</span> <span class="pre">b</span></code></p>
<p>la forme de <em>A</em> est $(2_A, 3_A)$ et la forme de <em>b</em> est ($1_b$,) , on compare les dimensions de droite</p>
<p>$3_A$ est associé à $1_b$, et du coup $b$ est élargi à $\begin{pmatrix} b &amp; b &amp; b  \end{pmatrix}$ de dimension $(1_b, 3_b)$</p>
<p>on ajoute maintenant un tableau $(2_A, 3_A)$ à une ligne $(1_b, 3_b)$</p>
<p>$\begin{pmatrix} a_{11} &amp; a_{12} &amp; a_{13} \ a_{21} &amp; a_{22} &amp; a_{23} \  \end{pmatrix} + \begin{pmatrix} b &amp; b &amp; b  \end{pmatrix}$</p>
<p>on compare les dimensions suivantes, $2_a$ est comparé à $1_b$, et de nouveau $b$ est élargi à la dimension $(2_b, 3_b)$</p>
<p>$\begin{pmatrix} a_{11} &amp; a_{12} &amp; a_{13} \ a_{21} &amp; a_{22} &amp; a_{23} \  \end{pmatrix} + \begin{pmatrix} b &amp; b &amp; b \ b &amp; b &amp; b \end{pmatrix} = \begin{pmatrix} a_{11} + b &amp; a_{12} + b &amp; a_{13} + b \ a_{21} + b &amp; a_{22} + b &amp; a_{23} + b \  \end{pmatrix}$</p>
<p>les formes sont désormais compatibles, les deux tableaux peuvent être ajoutés !</p>
<p>Et naturellement quand les formes ne sont pas consistantes, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> va rejeter le programme en vous envoyant une erreur de type <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>.</p>
<div class="cell tag_raises-exception tag_level_intermediate docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2275</span><span class="o">/</span><span class="mf">2566193894.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span>

<span class="ne">ValueError</span>: operands could not be broadcast together with shapes (2,3) (2,4) 
</pre></div>
</div>
</div>
</div>
<p>On la rattrape ?</p>
<div class="cell tag_level_intermediate docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="se">\n</span><span class="s1">+</span><span class="se">\n</span><span class="si">{</span><span class="n">m2</span><span class="si">}</span><span class="se">\n</span><span class="s1"> ➡ </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 1 2]
 [3 4 5]]
+
[[0 1 2 3]
 [4 5 6 7]]
 ➡ operands could not be broadcast together with shapes (2,3) (2,4) 
</pre></div>
</div>
</div>
</div>
<p>Encore un exemple où on ajoute une matrice comportant une seule ligne à une matrice comportant une seule colonne pour avoir une nouvelle matrice.</p>
<p>on veut faire l’opération $\begin{pmatrix} a_{1} &amp; a_{2} &amp; a_{3} \end{pmatrix} + \begin{pmatrix} b_1 \ b_2 \ b_3 \ b_4 \end{pmatrix}$</p>
<p>la forme de la matrice <em>a</em> est $(1_a, 3_a)$, la forme de la matrice <em>b</em> est $(4_b, 1_b)$</p>
<p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> compare $3_a$ à $1_b$ et il élargit <em>b</em> à $\begin{pmatrix} b_1 &amp; b_1 &amp; b_1 \ b_2 &amp; b_2 &amp; b_2 \ b_3 &amp; b_3 &amp; b_3 \ b_4 &amp; b_a &amp; b_4 \end{pmatrix}$</p>
<p>on ajoute maintenant un tableau $(1_a, 3_a)$ à une matrice $(4_b, 3_b)$</p>
<p>$\begin{pmatrix} a_{1} &amp; a_{2} &amp; a_{3} \end{pmatrix} + \begin{pmatrix} b_1 &amp; b_1 &amp; b_1 \ b_2 &amp; b_2 &amp; b_2 \ b_3 &amp; b_3 &amp; b_3 \ b_4 &amp; b_a &amp; b_4 \end{pmatrix}$</p>
<p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> compare les dimensions $1_a$ et $4_b$, et il élargit $a$ à $\begin{pmatrix} a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \end{pmatrix}$</p>
<p>$\begin{pmatrix} a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \ a_{1} &amp; a_{2} &amp; a_{3} \end{pmatrix} + \begin{pmatrix} b_1 &amp; b_1 &amp; b_1 \ b_2 &amp; b_2 &amp; b_2 \ b_3 &amp; b_3 &amp; b_3 \ b_4 &amp; b_a &amp; b_4 \end{pmatrix} = \begin{pmatrix} a_{1} + b_1 &amp; a_{2} + b_1 &amp; a_{3} + b_1 \ a_{1} + b_2 &amp; a_{2} + b_2 &amp; a_{3} + b_2 \ a_{1} + b_3 &amp; a_{2} + b_3 &amp; a_{3}  + b_3\ a_{1} + b_4 &amp; a_{2} + b_4 &amp; a_{3} + b_4 \end{pmatrix}$</p>
<p>les formes sont désormais compatibles, les deux tableaux ont pu être ajoutés !</p>
</div>
<div class="section" id="le-broadcasting-en-dimension-2">
<h2>le broadcasting en dimension &gt; 2<a class="headerlink" href="#le-broadcasting-en-dimension-2" title="Permalink to this headline">¶</a></h2>
<p>Naturellement le broadcasting se généralise à des dimensions supérieures à 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]],

       [[12, 13, 14, 15],
        [16, 17, 18, 19],
        [20, 21, 22, 23]]])
</pre></div>
</div>
</div>
</div>
<p>ajout d’un scalaire</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">+</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[10, 11, 12, 13],
        [14, 15, 16, 17],
        [18, 19, 20, 21]],

       [[22, 23, 24, 25],
        [26, 27, 28, 29],
        [30, 31, 32, 33]]])
</pre></div>
</div>
</div>
</div>
<p>ajout d’une matrice comportant une seule ligne … il l’ajoute à toutes les lignes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[100, 201, 302, 403],
        [104, 205, 306, 407],
        [108, 209, 310, 411]],

       [[112, 213, 314, 415],
        [116, 217, 318, 419],
        [120, 221, 322, 423]]])
</pre></div>
</div>
</div>
</div>
<p>ajout d’une matrice comportant une seule colonne</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="mi">3000</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[1000, 1001, 1002, 1003],
        [2004, 2005, 2006, 2007],
        [3008, 3009, 3010, 3011]],

       [[1012, 1013, 1014, 1015],
        [2016, 2017, 2018, 2019],
        [3020, 3021, 3022, 3023]]])
</pre></div>
</div>
</div>
</div>
<p>ajout de 2 matrices comportant 1 seule ligne dont la forme est (2, 1, 4)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vecl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="o">-</span><span class="mi">50000</span><span class="p">,</span> <span class="o">-</span><span class="mi">60000</span><span class="p">,</span> <span class="o">-</span><span class="mi">70000</span><span class="p">,</span> <span class="o">-</span><span class="mi">80000</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">vecl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[ 10000,  20000,  30000,  40000]],

       [[-50000, -60000, -70000, -80000]]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">+</span> <span class="n">vecl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[ 10000,  20001,  30002,  40003],
        [ 10004,  20005,  30006,  40007],
        [ 10008,  20009,  30010,  40011]],

       [[-49988, -59987, -69986, -79985],
        [-49984, -59983, -69982, -79981],
        [-49980, -59979, -69978, -79977]]])
</pre></div>
</div>
</div>
</div>
<p>ajout de 2 matrices comportant une seule colonne donc de forme (2, 3, 1)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vecc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">300000</span><span class="p">,</span> <span class="mi">400000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">600000</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">vecc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[100000],
        [200000],
        [300000]],

       [[400000],
        [500000],
        [600000]]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">+</span> <span class="n">vecc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[100000, 100001, 100002, 100003],
        [200004, 200005, 200006, 200007],
        [300008, 300009, 300010, 300011]],

       [[400012, 400013, 400014, 400015],
        [500016, 500017, 500018, 500019],
        [600020, 600021, 600022, 600023]]])
</pre></div>
</div>
</div>
</div>
<p>A vous de jouer. Essayer d’ajouter un tableau (généré par <code class="docutils literal notranslate"><span class="pre">np.arange</span></code> qui contient les entiers de 0 à 11) de la forme: 4 fois 1 matrice de 3 lignes sur 1 colonne … heu bon je pense que vous avez compris.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>
</pre></div>
</div>
</div>
</div>
<p>Si vous êtes fort en Python, et que vous avez du temps, sauriez-vous coder en Python, la fonction qui détermine si deux formes (données par des tuples) sont compatibles pour le broadcasting ? à vous de jouer…</p>
<div class="cell tag_level_advanced docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>

<span class="k">def</span> <span class="nf">are_broadcast_compatible</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Le broadcasting est très efficace. Les éléments broadcastés ne sont naturellement pas réellement créés en mémoire, mais le broadcasting est basé sur du code C optimisé qui va avoir le même genre d’efficacité que les opérations vectorisées. Donc à utiliser (intelligemment) !</p>
</div>
<div class="section" id="exercices">
<h2>exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="comparaison-des-temps-d-execution-de-l-ajout-d-un-scalaire-a-une-matrice">
<h3>comparaison des temps d’exécution de l’ajout d’un scalaire à une matrice<a class="headerlink" href="#comparaison-des-temps-d-execution-de-l-ajout-d-un-scalaire-a-une-matrice" title="Permalink to this headline">¶</a></h3>
<p>Construisez une matrice de forme <em>(3000, 3000)</em> contenant les entiers à partir de 1.</p>
<ol class="simple">
<li><p>Calculer le temps pour ajouter le scalaire <em>10</em> à cette matrice</p></li>
<li><p>Calculer le temps pour ajouter une matrice de taille de <em>(3000, 3000)</em> remplie de <code class="docutils literal notranslate"><span class="pre">1</span></code> à cette matrice.</p></li>
</ol>
<p>Pour la deuxième option, envisagez deux variantes dans lesquelles vous comptez ou non le temps nécessaire à la construction de la matrice temporaire</p>
<p>Expliquez pourquoi on fait ça…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="resultats-du-tirage-de-n-des-a-s-faces">
<h3>résultats du tirage de <code class="docutils literal notranslate"><span class="pre">n</span></code> dès à <code class="docutils literal notranslate"><span class="pre">s</span></code> faces<a class="headerlink" href="#resultats-du-tirage-de-n-des-a-s-faces" title="Permalink to this headline">¶</a></h3>
<p>Deux versions pour cet exercice:</p>
<ul class="simple">
<li><p>la première est pour les débutants, elle est guidée et amène à construire le résultat pas à pas</p></li>
<li><p>la deuxième est pour les forts qui se débrouillent tout seuls</p></li>
</ul>
<div class="section" id="version-pour-les-debutants">
<h4>version pour les débutants<a class="headerlink" href="#version-pour-les-debutants" title="Permalink to this headline">¶</a></h4>
<p>On veut calculer les résultats des tirages de <code class="docutils literal notranslate"><span class="pre">n</span></code> dés à <code class="docutils literal notranslate"><span class="pre">s</span></code> faces. Afin, par exemple de faire des probabilités d’obtention de certains tirages. De combien de manières différentes peut-on obtenir <code class="docutils literal notranslate"><span class="pre">7</span></code> avec <code class="docutils literal notranslate"><span class="pre">3</span></code> dès à <code class="docutils literal notranslate"><span class="pre">6</span></code> faces.</p>
<p>Si nous prenons un seul dès à <code class="docutils literal notranslate"><span class="pre">6</span></code> faces. Quels sont les tirages possibles ?</p>
<p>oui <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5,</span> <span class="pre">6</span></code></p>
<p>Construisez alors un <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> contenant les tirages d’un dès à <code class="docutils literal notranslate"><span class="pre">s</span></code> faces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>
</pre></div>
</div>
</div>
</div>
<p>Maintenant si on prend <code class="docutils literal notranslate"><span class="pre">n=2</span></code> dès à <code class="docutils literal notranslate"><span class="pre">s=6</span></code> faces. Quels sont les tirages possibles ?</p>
<p>Oui:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>+</p></th>
<th class="text-align:center head"><p>|</p></th>
<th class="text-align:center head"><p>1</p></th>
<th class="text-align:center head"><p>2</p></th>
<th class="text-align:center head"><p>3</p></th>
<th class="text-align:center head"><p>4</p></th>
<th class="text-align:center head"><p>5</p></th>
<th class="text-align:center head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><em>1</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>2</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><em>3</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>4</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><em>5</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>11</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>6</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>11</p></td>
<td class="text-align:center"><p>12</p></td>
</tr>
</tbody>
</table>
<p>Construisez alors un <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> contenant les tirages de <code class="docutils literal notranslate"><span class="pre">n=2</span></code> dès à <code class="docutils literal notranslate"><span class="pre">s=6</span></code> faces. Un indice ? Utilisez le <code class="docutils literal notranslate"><span class="pre">broadcasting</span></code>:</p>
<p>On vous fait un rappel. Si on ajoute en <code class="docutils literal notranslate"><span class="pre">numpy</span></code> un tableau de forme <code class="docutils literal notranslate"><span class="pre">(3,)</span></code> à un tableau de forme <code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">1)</span></code> on obtient la matrice suivante: $\begin{pmatrix} a_{1} &amp; a_{2} &amp; a_{3} \end{pmatrix} + \begin{pmatrix} b_1 \ b_2 \ b_3 \end{pmatrix} = \begin{pmatrix} a_{1} + b_1 &amp; a_{2} + b_1 &amp; a_{3} + b_1 \ a_{1} + b_2 &amp; a_{2} + b_2 &amp; a_{3} + b_2 \ a_{1} + b_3 &amp; a_{2} + b_3 &amp; a_{3}  + b_3\ a_{1} + b_4 &amp; a_{2} + b_4 &amp; a_{3} + b_4 \end{pmatrix}$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>
</pre></div>
</div>
</div>
</div>
<p>On remarque que la dimension de notre tableau est le nombre de dès.</p>
<p>On continue.</p>
<p>Maintenant si je prends <code class="docutils literal notranslate"><span class="pre">3</span></code> dès avec <code class="docutils literal notranslate"><span class="pre">6</span></code> faces, je suis en dimension <code class="docutils literal notranslate"><span class="pre">3</span></code> et je veux donc obtenir un <em>cube</em> (avec tous les résultats). Pour obtenir ce cube, je pars de ma matrice (de forme <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">s)</span></code>) des tirages en dimension 2 et j’utilise le broadcast pour lui ajouter une troisième dimension.</p>
<p>Quelle est la forme de ce vecteur ? Il doit déclencher le broadcast donc il doit être de forme <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">1,</span> <span class="pre">1)</span></code>.</p>
<p>En effet<br />
(i) la forme <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">)</span></code> c’est la forme des lignes de la matrice<br />
(ii) la forme <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">1)</span></code> est celle des colonnes<br />
(iii) la forme <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">...,</span> <span class="pre">1,</span> <span class="pre">s)</span></code> se broadcast en ligne comme <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">s)</span></code> ou <code class="docutils literal notranslate"><span class="pre">(s,)</span></code> (essayez)
(iv) la forme <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">1,</span> <span class="pre">1)</span></code> forcera le broadcast en un cube</p>
<p>Vous avez maintenant tous les indices pour généraliser en dimension <code class="docutils literal notranslate"><span class="pre">n</span></code> dès (vous aurez naturellement une boucle mais bien sûr pas sur les éléments d’un <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> !)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># votre code ici</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tirages</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Cet espace des tirage pourra nous resservir dans de futurs exercices.</p>
<p>Vous remarquez qu’on est dans une manière de faire qui <strong>explicite l’ensemble des solutions</strong> ce qu’on appelle une méthode en force brute. Ces méthodes sont clairement exponentielles.</p>
</div>
<div class="section" id="les-des-version-pour-les-forts">
<h4>les dès version  pour les forts<a class="headerlink" href="#les-des-version-pour-les-forts" title="Permalink to this headline">¶</a></h4>
<p>On étudie les probabilités d’obtenir une certaine somme avec plusieurs dés.</p>
<p>Tout le monde connaît le cas classique avec deux dés à 6 faces, ou l’on construit mentalement la grille suivante:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>+</p></th>
<th class="text-align:center head"><p>|</p></th>
<th class="text-align:center head"><p>1</p></th>
<th class="text-align:center head"><p>2</p></th>
<th class="text-align:center head"><p>3</p></th>
<th class="text-align:center head"><p>4</p></th>
<th class="text-align:center head"><p>5</p></th>
<th class="text-align:center head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><em>1</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>2</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><em>3</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>4</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><em>5</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>11</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><em>6</em></p></td>
<td class="text-align:center"><p>|</p></td>
<td class="text-align:center"><p>7</p></td>
<td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p>9</p></td>
<td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>11</p></td>
<td class="text-align:center"><p>12</p></td>
</tr>
</tbody>
</table>
<p>Imaginons que vous êtes un étudiant, vous venez de faire un exercice de maths qui vous a mené à une formule qui permet de calculer, pour un jeu à <code class="docutils literal notranslate"><span class="pre">nb_dice</span></code> dés, chacun à <code class="docutils literal notranslate"><span class="pre">sides</span></code> faces, le nombre de tirages qui donnent une certaine somme <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
<p>Vous voulez <strong>vérifier votre formule</strong>, en appliquant une <strong>méthode de force brute</strong>. C’est-à-dire constuire un hypercube avec toutes les possibilités de tirage, puis calculer pour chaque point dans l’hypercube la somme correspondante; de cette façon on pourra compter les occurrences de <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
<p>C’est l’objet de cet exercice. Vous devez écrire une fonction <code class="docutils literal notranslate"><span class="pre">dice</span></code> qui prend en paramètres:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target</span></code> : la somme cible à atteindre,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nb_dice</span></code> : le nombre de dés,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sides</span></code>: le nombre de faces sur chaque dé.</p></li>
</ul>
<p>On convient que par défaut <code class="docutils literal notranslate"><span class="pre">nb_dice</span></code>=2 et <code class="docutils literal notranslate"><span class="pre">sides</span></code>=6, qui correspond au cas habituel.</p>
<p>Dans ce cas-là par exemple, on voit, en comptant la longueur des diagonales sur la figure, que <code class="docutils literal notranslate"><span class="pre">dice(7)</span></code> doit valoir 6, puisque le tableau comporte 6 cases contenant 7 sur la diagonale.</p>
<p>À nouveau, on demande explicitement ici un parcours de type force brute; c’est-à-dire de créer sous la forme d’un tableau <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, un hypercube qui énumère toutes les combinaisons possibles; et sans faire de <code class="docutils literal notranslate"><span class="pre">for</span></code> sur les éléments d’un tableau.</p>
<p>https://nbhosting.inria.fr/auditor/notebook/python-mooc:exos/w7/w7-s05-x4-dice</p>
<p><strong>Indice</strong></p>
<p>Il existe en <code class="docutils literal notranslate"><span class="pre">numpy</span></code> une astuce pour augmenter la dimension d’un tableau, ça s’appelle <code class="docutils literal notranslate"><span class="pre">np.newaxis</span></code>, et ça s’utilise comme ceci</p>
<div class="cell tag_level_advanced docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dice_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">dice_2</span> <span class="o">=</span> <span class="n">dice_1</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_level_advanced docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dice_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 2, 3, 4, 5, 6])
</pre></div>
</div>
</div>
</div>
<div class="cell tag_level_advanced docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dice_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1],
       [2],
       [3],
       [4],
       [5],
       [6]])
</pre></div>
</div>
</div>
</div>
<p>et remarquez que pour créer le tableau ci-dessus il suffit de faire</p>
<div class="cell tag_level_advanced docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dice_1</span> <span class="o">+</span> <span class="n">dice_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 2,  3,  4,  5,  6,  7],
       [ 3,  4,  5,  6,  7,  8],
       [ 4,  5,  6,  7,  8,  9],
       [ 5,  6,  7,  8,  9, 10],
       [ 6,  7,  8,  9, 10, 11],
       [ 7,  8,  9, 10, 11, 12]])
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="2-04-numpy-indexing-slicing.html" title="previous page">indexation et slicing</a>
    <a class='right-next' id="next-link" href="2-06-numpy-aggregate.html" title="next page">agrégation</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Thierry Parmentelat<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>